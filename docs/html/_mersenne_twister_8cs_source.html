<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PhysLib: D:/Dev/PhysBox/PhysLib/MersenneTwister.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>D:/Dev/PhysBox/PhysLib/MersenneTwister.cs</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright 2007-2008 Rory Plaire (codekaizen@gmail.com)</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">// Adapted from:</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment">/* C# Version Copyright (C) 2001-2004 Akihilo Kramot (Takel).  */</span>
<a name="l00006"></a>00006 <span class="comment">/* C# porting from a C-program for MT19937, originaly coded by */</span>
<a name="l00007"></a>00007 <span class="comment">/* Takuji Nishimura and Makoto Matsumoto, considering the suggestions by */</span>
<a name="l00008"></a>00008 <span class="comment">/* Topher Cooper and Marc Rieffel in July-Aug. 1997.           */</span>
<a name="l00009"></a>00009 <span class="comment">/* This library is free software under the Artistic license:   */</span>
<a name="l00010"></a>00010 <span class="comment">/*                                                             */</span>
<a name="l00011"></a>00011 <span class="comment">/* You can find the original C-program at                      */</span>
<a name="l00012"></a>00012 <span class="comment">/*     http://www.math.keio.ac.jp/~matumoto/mt.html            */</span>
<a name="l00013"></a>00013 <span class="comment">/*                                                             */</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">// and:</span>
<a name="l00016"></a>00016 
<a name="l00018"></a>00018 <span class="comment">// C# Version Copyright (c) 2003 CenterSpace Software, LLC                 //</span>
<a name="l00019"></a>00019 <span class="comment">//                                                                         //</span>
<a name="l00020"></a>00020 <span class="comment">// This code is free software under the Artistic license.                  //</span>
<a name="l00021"></a>00021 <span class="comment">//                                                                         //</span>
<a name="l00022"></a>00022 <span class="comment">// CenterSpace Software                                                    //</span>
<a name="l00023"></a>00023 <span class="comment">// 2098 NW Myrtlewood Way                                                  //</span>
<a name="l00024"></a>00024 <span class="comment">// Corvallis, Oregon, 97330                                                //</span>
<a name="l00025"></a>00025 <span class="comment">// USA                                                                     //</span>
<a name="l00026"></a>00026 <span class="comment">// http://www.centerspace.net                                              //</span>
<a name="l00028"></a>00028 <span class="comment"></span>
<a name="l00029"></a>00029 <span class="comment">// and, of course:</span>
<a name="l00030"></a>00030 <span class="comment">/* </span>
<a name="l00031"></a>00031 <span class="comment">   A C-program for MT19937, with initialization improved 2002/2/10.</span>
<a name="l00032"></a>00032 <span class="comment">   Coded by Takuji Nishimura and Makoto Matsumoto.</span>
<a name="l00033"></a>00033 <span class="comment">   This is a faster version by taking Shawn Cokus&apos;s optimization,</span>
<a name="l00034"></a>00034 <span class="comment">   Matthe Bellew&apos;s simplification, Isaku Wada&apos;s real version.</span>
<a name="l00035"></a>00035 <span class="comment"></span>
<a name="l00036"></a>00036 <span class="comment">   Before using, initialize the state by using init_genrand(seed) </span>
<a name="l00037"></a>00037 <span class="comment">   or init_by_array(init_key, key_length).</span>
<a name="l00038"></a>00038 <span class="comment"></span>
<a name="l00039"></a>00039 <span class="comment">   Copyright (C) 1997 - 2002, Makoto Matsumoto and Takuji Nishimura,</span>
<a name="l00040"></a>00040 <span class="comment">   All rights reserved.                          </span>
<a name="l00041"></a>00041 <span class="comment"></span>
<a name="l00042"></a>00042 <span class="comment">   Redistribution and use in source and binary forms, with or without</span>
<a name="l00043"></a>00043 <span class="comment">   modification, are permitted provided that the following conditions</span>
<a name="l00044"></a>00044 <span class="comment">   are met:</span>
<a name="l00045"></a>00045 <span class="comment"></span>
<a name="l00046"></a>00046 <span class="comment">     1. Redistributions of source code must retain the above copyright</span>
<a name="l00047"></a>00047 <span class="comment">        notice, this list of conditions and the following disclaimer.</span>
<a name="l00048"></a>00048 <span class="comment"></span>
<a name="l00049"></a>00049 <span class="comment">     2. Redistributions in binary form must reproduce the above copyright</span>
<a name="l00050"></a>00050 <span class="comment">        notice, this list of conditions and the following disclaimer in the</span>
<a name="l00051"></a>00051 <span class="comment">        documentation and/or other materials provided with the distribution.</span>
<a name="l00052"></a>00052 <span class="comment"></span>
<a name="l00053"></a>00053 <span class="comment">     3. The names of its contributors may not be used to endorse or promote </span>
<a name="l00054"></a>00054 <span class="comment">        products derived from this software without specific prior written </span>
<a name="l00055"></a>00055 <span class="comment">        permission.</span>
<a name="l00056"></a>00056 <span class="comment"></span>
<a name="l00057"></a>00057 <span class="comment">   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00058"></a>00058 <span class="comment">   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00059"></a>00059 <span class="comment">   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00060"></a>00060 <span class="comment">   A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span>
<a name="l00061"></a>00061 <span class="comment">   CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<a name="l00062"></a>00062 <span class="comment">   EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<a name="l00063"></a>00063 <span class="comment">   PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<a name="l00064"></a>00064 <span class="comment">   PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<a name="l00065"></a>00065 <span class="comment">   LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<a name="l00066"></a>00066 <span class="comment">   NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00067"></a>00067 <span class="comment">   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00068"></a>00068 <span class="comment"></span>
<a name="l00069"></a>00069 <span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">   Any feedback is very welcome.</span>
<a name="l00071"></a>00071 <span class="comment">   http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/emt.html</span>
<a name="l00072"></a>00072 <span class="comment">   email: m-mat @ math.sci.hiroshima-u.ac.jp (remove space)</span>
<a name="l00073"></a>00073 <span class="comment">*/</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="keyword">using</span> System;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="keyword">namespace </span>Mersenne
<a name="l00079"></a>00079 {
<a name="l00088"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html">00088</a>     <span class="keyword">internal</span> <span class="keyword">class </span><a class="code" href="class_mersenne_1_1_mersenne_twister.html" title="Generates pseudo-random numbers using the Mersenne Twister algorithm.">MersenneTwister</a> : Random
<a name="l00089"></a>00089     {
<a name="l00094"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#a530f2f6464d5da92a4350437009952d6">00094</a>         <span class="keyword">public</span> <a class="code" href="class_mersenne_1_1_mersenne_twister.html#a831d500c97e2c77ee3e8418427421fd0" title="Creates a new pseudo-random number generator with a default seed.">MersenneTwister</a>(Int32 seed)
<a name="l00095"></a>00095         {
<a name="l00096"></a>00096             init((UInt32)seed);
<a name="l00097"></a>00097         }
<a name="l00098"></a>00098 
<a name="l00106"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#a831d500c97e2c77ee3e8418427421fd0">00106</a>         <span class="keyword">public</span> <a class="code" href="class_mersenne_1_1_mersenne_twister.html#a831d500c97e2c77ee3e8418427421fd0" title="Creates a new pseudo-random number generator with a default seed.">MersenneTwister</a>()
<a name="l00107"></a>00107             : this(new Random().<a class="code" href="class_mersenne_1_1_mersenne_twister.html#af8cec3c85b54d9ec0f9bb9bb295aa148" title="Returns the next pseudo-random Int32.">Next</a>()) <span class="comment">/* a default initial seed is used   */</span>
<a name="l00108"></a>00108         { }
<a name="l00109"></a>00109 
<a name="l00114"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#a86a533c089c1a7c029341998d8682340">00114</a>         <span class="keyword">public</span> <a class="code" href="class_mersenne_1_1_mersenne_twister.html#a831d500c97e2c77ee3e8418427421fd0" title="Creates a new pseudo-random number generator with a default seed.">MersenneTwister</a>(Int32[] initKey)
<a name="l00115"></a>00115         {
<a name="l00116"></a>00116             <span class="keywordflow">if</span> (initKey == null)
<a name="l00117"></a>00117             {
<a name="l00118"></a>00118                 <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="stringliteral">&quot;initKey&quot;</span>);
<a name="l00119"></a>00119             }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121             UInt32[] initArray = <span class="keyword">new</span> UInt32[initKey.Length];
<a name="l00122"></a>00122 
<a name="l00123"></a>00123             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; initKey.Length; ++i)
<a name="l00124"></a>00124             {
<a name="l00125"></a>00125                 initArray[i] = (UInt32)initKey[i];
<a name="l00126"></a>00126             }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128             init(initArray);
<a name="l00129"></a>00129         }
<a name="l00130"></a>00130 
<a name="l00135"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#ab8bdb56335225819b49aca770adfbc57">00135</a>         <span class="keyword">public</span> <span class="keyword">virtual</span> UInt32 <a class="code" href="class_mersenne_1_1_mersenne_twister.html#ab8bdb56335225819b49aca770adfbc57" title="Returns the next pseudo-random UInt32.">NextUInt32</a>()
<a name="l00136"></a>00136         {
<a name="l00137"></a>00137             <span class="keywordflow">return</span> <a class="code" href="class_mersenne_1_1_mersenne_twister.html#ac67afdf144ff89baac5f8754c55ad1c7" title="Generates a new pseudo-random UInt32.">GenerateUInt32</a>();
<a name="l00138"></a>00138         }
<a name="l00139"></a>00139 
<a name="l00150"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#ab38ec90f2b1a183a7b719cc829684610">00150</a>         <span class="keyword">public</span> <span class="keyword">virtual</span> UInt32 <a class="code" href="class_mersenne_1_1_mersenne_twister.html#ab8bdb56335225819b49aca770adfbc57" title="Returns the next pseudo-random UInt32.">NextUInt32</a>(UInt32 maxValue)
<a name="l00151"></a>00151         {
<a name="l00152"></a>00152             <span class="keywordflow">return</span> (UInt32)(<a class="code" href="class_mersenne_1_1_mersenne_twister.html#ac67afdf144ff89baac5f8754c55ad1c7" title="Generates a new pseudo-random UInt32.">GenerateUInt32</a>() / ((Double)UInt32.MaxValue / maxValue));
<a name="l00153"></a>00153         }
<a name="l00154"></a>00154 
<a name="l00168"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#a36e603285be14467bad5c0940eb81a29">00168</a>         <span class="keyword">public</span> <span class="keyword">virtual</span> UInt32 <a class="code" href="class_mersenne_1_1_mersenne_twister.html#ab8bdb56335225819b49aca770adfbc57" title="Returns the next pseudo-random UInt32.">NextUInt32</a>(UInt32 minValue, UInt32 maxValue) <span class="comment">/* throws ArgumentOutOfRangeException */</span>
<a name="l00169"></a>00169         {
<a name="l00170"></a>00170             <span class="keywordflow">if</span> (minValue &gt;= maxValue)
<a name="l00171"></a>00171             {
<a name="l00172"></a>00172                 <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException();
<a name="l00173"></a>00173             }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175             <span class="keywordflow">return</span> (UInt32)(<a class="code" href="class_mersenne_1_1_mersenne_twister.html#ac67afdf144ff89baac5f8754c55ad1c7" title="Generates a new pseudo-random UInt32.">GenerateUInt32</a>() / ((Double)UInt32.MaxValue / (maxValue - minValue)) + minValue);
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177 
<a name="l00182"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#af8cec3c85b54d9ec0f9bb9bb295aa148">00182</a>         <span class="keyword">public</span> <span class="keyword">override</span> Int32 <a class="code" href="class_mersenne_1_1_mersenne_twister.html#af8cec3c85b54d9ec0f9bb9bb295aa148" title="Returns the next pseudo-random Int32.">Next</a>()
<a name="l00183"></a>00183         {
<a name="l00184"></a>00184             <span class="keywordflow">return</span> <a class="code" href="class_mersenne_1_1_mersenne_twister.html#af8cec3c85b54d9ec0f9bb9bb295aa148" title="Returns the next pseudo-random Int32.">Next</a>(Int32.MaxValue);
<a name="l00185"></a>00185         }
<a name="l00186"></a>00186 
<a name="l00197"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#a777a6d68a6339f1f16f1d023c178092b">00197</a>         <span class="keyword">public</span> <span class="keyword">override</span> Int32 <a class="code" href="class_mersenne_1_1_mersenne_twister.html#af8cec3c85b54d9ec0f9bb9bb295aa148" title="Returns the next pseudo-random Int32.">Next</a>(Int32 maxValue)
<a name="l00198"></a>00198         {
<a name="l00199"></a>00199             <span class="keywordflow">if</span> (maxValue &lt;= 1)
<a name="l00200"></a>00200             {
<a name="l00201"></a>00201                 <span class="keywordflow">if</span> (maxValue &lt; 0)
<a name="l00202"></a>00202                 {
<a name="l00203"></a>00203                     <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException();
<a name="l00204"></a>00204                 }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206                 <span class="keywordflow">return</span> 0;
<a name="l00207"></a>00207             }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209             <span class="keywordflow">return</span> (Int32)(<a class="code" href="class_mersenne_1_1_mersenne_twister.html#aec9b7bee9aaa53e311986c379dfe88ab" title="Returns the next pseudo-random Double value.">NextDouble</a>() * maxValue);
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211 
<a name="l00224"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#abf827c82bc514bde5e225f1b34f6eca8">00224</a>         <span class="keyword">public</span> <span class="keyword">override</span> Int32 <a class="code" href="class_mersenne_1_1_mersenne_twister.html#af8cec3c85b54d9ec0f9bb9bb295aa148" title="Returns the next pseudo-random Int32.">Next</a>(Int32 minValue, Int32 maxValue)
<a name="l00225"></a>00225         {
<a name="l00226"></a>00226             <span class="keywordflow">if</span> (maxValue &lt;= minValue)
<a name="l00227"></a>00227             {
<a name="l00228"></a>00228                 <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException();
<a name="l00229"></a>00229             }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231             <span class="keywordflow">if</span> (maxValue == minValue)
<a name="l00232"></a>00232             {
<a name="l00233"></a>00233                 <span class="keywordflow">return</span> minValue;
<a name="l00234"></a>00234             }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236             <span class="keywordflow">return</span> <a class="code" href="class_mersenne_1_1_mersenne_twister.html#af8cec3c85b54d9ec0f9bb9bb295aa148" title="Returns the next pseudo-random Int32.">Next</a>(maxValue - minValue) + minValue;
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238 
<a name="l00246"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#a44ac8be1204224e0526882d86b4d5f40">00246</a>         <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_mersenne_1_1_mersenne_twister.html#a44ac8be1204224e0526882d86b4d5f40" title="Fills a buffer with pseudo-random bytes.">NextBytes</a>(Byte[] buffer)
<a name="l00247"></a>00247         {
<a name="l00248"></a>00248             <span class="comment">// [codekaizen: corrected this to check null before checking length.]</span>
<a name="l00249"></a>00249             <span class="keywordflow">if</span> (buffer == null)
<a name="l00250"></a>00250             {
<a name="l00251"></a>00251                 <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException();
<a name="l00252"></a>00252             }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254             Int32 bufLen = buffer.Length;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256             <span class="keywordflow">for</span> (Int32 idx = 0; idx &lt; bufLen; ++idx)
<a name="l00257"></a>00257             {
<a name="l00258"></a>00258                 buffer[idx] = (Byte)<a class="code" href="class_mersenne_1_1_mersenne_twister.html#af8cec3c85b54d9ec0f9bb9bb295aa148" title="Returns the next pseudo-random Int32.">Next</a>(256);
<a name="l00259"></a>00259             }
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261 
<a name="l00290"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#aec9b7bee9aaa53e311986c379dfe88ab">00290</a>         <span class="keyword">public</span> <span class="keyword">override</span> Double <a class="code" href="class_mersenne_1_1_mersenne_twister.html#aec9b7bee9aaa53e311986c379dfe88ab" title="Returns the next pseudo-random Double value.">NextDouble</a>()
<a name="l00291"></a>00291         {
<a name="l00292"></a>00292             <span class="keywordflow">return</span> compute53BitRandom(0, InverseOnePlus53BitsOf1s);
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294 
<a name="l00313"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#a61280b925d566a3191989f80d97786db">00313</a>         <span class="keyword">public</span> Double <a class="code" href="class_mersenne_1_1_mersenne_twister.html#aec9b7bee9aaa53e311986c379dfe88ab" title="Returns the next pseudo-random Double value.">NextDouble</a>(Boolean includeOne)
<a name="l00314"></a>00314         {
<a name="l00315"></a>00315             <span class="keywordflow">return</span> includeOne ? compute53BitRandom(0, Inverse53BitsOf1s) : <a class="code" href="class_mersenne_1_1_mersenne_twister.html#aec9b7bee9aaa53e311986c379dfe88ab" title="Returns the next pseudo-random Double value.">NextDouble</a>();
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317 
<a name="l00322"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#aec38f5a56453c9a80a2509c624bc10c8">00322</a>         <span class="keyword">public</span> Double <a class="code" href="class_mersenne_1_1_mersenne_twister.html#aec38f5a56453c9a80a2509c624bc10c8" title="Returns a pseudo-random number greater than 0.0 and less than 1.0.">NextDoublePositive</a>()
<a name="l00323"></a>00323         {
<a name="l00324"></a>00324             <span class="keywordflow">return</span> compute53BitRandom(0.5, Inverse53BitsOf1s);
<a name="l00325"></a>00325         }
<a name="l00326"></a>00326 
<a name="l00334"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#a7c17b816afc22f50a3b112ac95d4361b">00334</a>         <span class="keyword">public</span> Single <a class="code" href="class_mersenne_1_1_mersenne_twister.html#a7c17b816afc22f50a3b112ac95d4361b" title="Returns a pseudo-random number between 0.0 and 1.0.">NextSingle</a>()
<a name="l00335"></a>00335         {
<a name="l00336"></a>00336             <span class="keywordflow">return</span> (Single)<a class="code" href="class_mersenne_1_1_mersenne_twister.html#aec9b7bee9aaa53e311986c379dfe88ab" title="Returns the next pseudo-random Double value.">NextDouble</a>();
<a name="l00337"></a>00337         }
<a name="l00338"></a>00338 
<a name="l00356"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#aac50cc30f206ffe1c3d3ffa087c6de59">00356</a>         <span class="keyword">public</span> Single <a class="code" href="class_mersenne_1_1_mersenne_twister.html#a7c17b816afc22f50a3b112ac95d4361b" title="Returns a pseudo-random number between 0.0 and 1.0.">NextSingle</a>(Boolean includeOne)
<a name="l00357"></a>00357         {
<a name="l00358"></a>00358             <span class="keywordflow">return</span> (Single)<a class="code" href="class_mersenne_1_1_mersenne_twister.html#aec9b7bee9aaa53e311986c379dfe88ab" title="Returns the next pseudo-random Double value.">NextDouble</a>(includeOne);
<a name="l00359"></a>00359         }
<a name="l00360"></a>00360 
<a name="l00365"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#af75bcaef3b8c5749844f1cbc2610e671">00365</a>         <span class="keyword">public</span> Single <a class="code" href="class_mersenne_1_1_mersenne_twister.html#af75bcaef3b8c5749844f1cbc2610e671" title="Returns a pseudo-random number greater than 0.0 and less than 1.0.">NextSinglePositive</a>()
<a name="l00366"></a>00366         {
<a name="l00367"></a>00367             <span class="keywordflow">return</span> (Single)<a class="code" href="class_mersenne_1_1_mersenne_twister.html#aec38f5a56453c9a80a2509c624bc10c8" title="Returns a pseudo-random number greater than 0.0 and less than 1.0.">NextDoublePositive</a>();
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369 
<a name="l00374"></a>00374         [CLSCompliant(<span class="keyword">false</span>)]
<a name="l00375"></a><a class="code" href="class_mersenne_1_1_mersenne_twister.html#ac67afdf144ff89baac5f8754c55ad1c7">00375</a>         <span class="keyword">protected</span> UInt32 <a class="code" href="class_mersenne_1_1_mersenne_twister.html#ac67afdf144ff89baac5f8754c55ad1c7" title="Generates a new pseudo-random UInt32.">GenerateUInt32</a>()
<a name="l00376"></a>00376         {
<a name="l00377"></a>00377             UInt32 y;
<a name="l00378"></a>00378 
<a name="l00379"></a>00379             <span class="comment">/* _mag01[x] = x * MatrixA  for x=0,1 */</span>
<a name="l00380"></a>00380             <span class="keywordflow">if</span> (_mti &gt;= N) <span class="comment">/* generate N words at one time */</span>
<a name="l00381"></a>00381             {
<a name="l00382"></a>00382                 Int16 kk = 0;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384                 <span class="keywordflow">for</span> (; kk &lt; N - M; ++kk)
<a name="l00385"></a>00385                 {
<a name="l00386"></a>00386                     y = (_mt[kk] &amp; UpperMask) | (_mt[kk + 1] &amp; LowerMask);
<a name="l00387"></a>00387                     _mt[kk] = _mt[kk + M] ^ (y &gt;&gt; 1) ^ _mag01[y &amp; 0x1];
<a name="l00388"></a>00388                 }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390                 <span class="keywordflow">for</span> (; kk &lt; N - 1; ++kk)
<a name="l00391"></a>00391                 {
<a name="l00392"></a>00392                     y = (_mt[kk] &amp; UpperMask) | (_mt[kk + 1] &amp; LowerMask);
<a name="l00393"></a>00393                     _mt[kk] = _mt[kk + (M - N)] ^ (y &gt;&gt; 1) ^ _mag01[y &amp; 0x1];
<a name="l00394"></a>00394                 }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396                 y = (_mt[N - 1] &amp; UpperMask) | (_mt[0] &amp; LowerMask);
<a name="l00397"></a>00397                 _mt[N - 1] = _mt[M - 1] ^ (y &gt;&gt; 1) ^ _mag01[y &amp; 0x1];
<a name="l00398"></a>00398 
<a name="l00399"></a>00399                 _mti = 0;
<a name="l00400"></a>00400             }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402             y = _mt[_mti++];
<a name="l00403"></a>00403             y ^= temperingShiftU(y);
<a name="l00404"></a>00404             y ^= temperingShiftS(y) &amp; TemperingMaskB;
<a name="l00405"></a>00405             y ^= temperingShiftT(y) &amp; TemperingMaskC;
<a name="l00406"></a>00406             y ^= temperingShiftL(y);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408             <span class="keywordflow">return</span> y;
<a name="l00409"></a>00409         }
<a name="l00410"></a>00410         
<a name="l00411"></a>00411         <span class="comment">/* Period parameters */</span>
<a name="l00412"></a>00412         <span class="keyword">private</span> <span class="keyword">const</span> Int32 N = 624;
<a name="l00413"></a>00413         <span class="keyword">private</span> <span class="keyword">const</span> Int32 M = 397;
<a name="l00414"></a>00414         <span class="keyword">private</span> <span class="keyword">const</span> UInt32 MatrixA = 0x9908b0df; <span class="comment">/* constant vector a */</span>
<a name="l00415"></a>00415         <span class="keyword">private</span> <span class="keyword">const</span> UInt32 UpperMask = 0x80000000; <span class="comment">/* most significant w-r bits */</span>
<a name="l00416"></a>00416         <span class="keyword">private</span> <span class="keyword">const</span> UInt32 LowerMask = 0x7fffffff; <span class="comment">/* least significant r bits */</span>
<a name="l00417"></a>00417 
<a name="l00418"></a>00418         <span class="comment">/* Tempering parameters */</span>
<a name="l00419"></a>00419         <span class="keyword">private</span> <span class="keyword">const</span> UInt32 TemperingMaskB = 0x9d2c5680;
<a name="l00420"></a>00420         <span class="keyword">private</span> <span class="keyword">const</span> UInt32 TemperingMaskC = 0xefc60000;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422         <span class="keyword">private</span> <span class="keyword">static</span> UInt32 temperingShiftU(UInt32 y)
<a name="l00423"></a>00423         {
<a name="l00424"></a>00424             <span class="keywordflow">return</span> (y &gt;&gt; 11);
<a name="l00425"></a>00425         }
<a name="l00426"></a>00426 
<a name="l00427"></a>00427         <span class="keyword">private</span> <span class="keyword">static</span> UInt32 temperingShiftS(UInt32 y)
<a name="l00428"></a>00428         {
<a name="l00429"></a>00429             <span class="keywordflow">return</span> (y &lt;&lt; 7);
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432         <span class="keyword">private</span> <span class="keyword">static</span> UInt32 temperingShiftT(UInt32 y)
<a name="l00433"></a>00433         {
<a name="l00434"></a>00434             <span class="keywordflow">return</span> (y &lt;&lt; 15);
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437         <span class="keyword">private</span> <span class="keyword">static</span> UInt32 temperingShiftL(UInt32 y)
<a name="l00438"></a>00438         {
<a name="l00439"></a>00439             <span class="keywordflow">return</span> (y &gt;&gt; 18);
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442         <span class="keyword">private</span> readonly UInt32[] _mt = <span class="keyword">new</span> UInt32[N]; <span class="comment">/* the array for the state vector  */</span>
<a name="l00443"></a>00443         <span class="keyword">private</span> Int16 _mti;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445         <span class="keyword">private</span> <span class="keyword">static</span> readonly UInt32[] _mag01 = { 0x0, MatrixA };
<a name="l00446"></a>00446 
<a name="l00447"></a>00447         <span class="keyword">private</span> <span class="keywordtype">void</span> init(UInt32 seed)
<a name="l00448"></a>00448         {
<a name="l00449"></a>00449             _mt[0] = seed &amp; 0xffffffffU;
<a name="l00450"></a>00450 
<a name="l00451"></a>00451             <span class="keywordflow">for</span> (_mti = 1; _mti &lt; N; _mti++)
<a name="l00452"></a>00452             {
<a name="l00453"></a>00453                 _mt[_mti] = (uint)(1812433253U * (_mt[_mti - 1] ^ (_mt[_mti - 1] &gt;&gt; 30)) + _mti);
<a name="l00454"></a>00454                 <span class="comment">// See Knuth TAOCP Vol2. 3rd Ed. P.106 for multiplier. </span>
<a name="l00455"></a>00455                 <span class="comment">// In the previous versions, MSBs of the seed affect   </span>
<a name="l00456"></a>00456                 <span class="comment">// only MSBs of the array _mt[].                        </span>
<a name="l00457"></a>00457                 <span class="comment">// 2002/01/09 modified by Makoto Matsumoto             </span>
<a name="l00458"></a>00458                 _mt[_mti] &amp;= 0xffffffffU;
<a name="l00459"></a>00459                 <span class="comment">// for &gt;32 bit machines</span>
<a name="l00460"></a>00460             }
<a name="l00461"></a>00461         }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463         <span class="keyword">private</span> <span class="keywordtype">void</span> init(UInt32[] key)
<a name="l00464"></a>00464         {
<a name="l00465"></a>00465             Int32 i, j, k;
<a name="l00466"></a>00466             init(19650218U);
<a name="l00467"></a>00467 
<a name="l00468"></a>00468             Int32 keyLength = key.Length;
<a name="l00469"></a>00469             i = 1; j = 0;
<a name="l00470"></a>00470             k = (N &gt; keyLength ? N : keyLength);
<a name="l00471"></a>00471 
<a name="l00472"></a>00472             <span class="keywordflow">for</span> (; k &gt; 0; k--)
<a name="l00473"></a>00473             {
<a name="l00474"></a>00474                 _mt[i] = (uint)((_mt[i] ^ ((_mt[i - 1] ^ (_mt[i - 1] &gt;&gt; 30)) * 1664525U)) + key[j] + j); <span class="comment">/* non linear */</span>
<a name="l00475"></a>00475                 _mt[i] &amp;= 0xffffffffU; <span class="comment">// for WORDSIZE &gt; 32 machines</span>
<a name="l00476"></a>00476                 i++; j++;
<a name="l00477"></a>00477                 <span class="keywordflow">if</span> (i &gt;= N) { _mt[0] = _mt[N - 1]; i = 1; }
<a name="l00478"></a>00478                 <span class="keywordflow">if</span> (j &gt;= keyLength) j = 0;
<a name="l00479"></a>00479             }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481             <span class="keywordflow">for</span> (k = N - 1; k &gt; 0; k--)
<a name="l00482"></a>00482             {
<a name="l00483"></a>00483                 _mt[i] = (uint)((_mt[i] ^ ((_mt[i - 1] ^ (_mt[i - 1] &gt;&gt; 30)) * 1566083941U)) - i); <span class="comment">/* non linear */</span>
<a name="l00484"></a>00484                 _mt[i] &amp;= 0xffffffffU; <span class="comment">// for WORDSIZE &gt; 32 machines</span>
<a name="l00485"></a>00485                 i++;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487                 <span class="keywordflow">if</span> (i &lt; N)
<a name="l00488"></a>00488                 {
<a name="l00489"></a>00489                     <span class="keywordflow">continue</span>;
<a name="l00490"></a>00490                 }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492                 _mt[0] = _mt[N - 1]; i = 1;
<a name="l00493"></a>00493             }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495             _mt[0] = 0x80000000U; <span class="comment">// MSB is 1; assuring non-zero initial array</span>
<a name="l00496"></a>00496         }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498 
<a name="l00499"></a>00499         <span class="comment">// 9007199254740991.0 is the maximum double value which the 53 significand</span>
<a name="l00500"></a>00500         <span class="comment">// can hold when the exponent is 0.</span>
<a name="l00501"></a>00501         <span class="keyword">private</span> <span class="keyword">const</span> Double FiftyThreeBitsOf1s = 9007199254740991.0;
<a name="l00502"></a>00502         <span class="comment">// Multiply by inverse to (vainly?) try to avoid a division.</span>
<a name="l00503"></a>00503         <span class="keyword">private</span> <span class="keyword">const</span> Double Inverse53BitsOf1s = 1.0 / FiftyThreeBitsOf1s;
<a name="l00504"></a>00504         <span class="keyword">private</span> <span class="keyword">const</span> Double OnePlus53BitsOf1s = FiftyThreeBitsOf1s + 1;
<a name="l00505"></a>00505         <span class="keyword">private</span> <span class="keyword">const</span> Double InverseOnePlus53BitsOf1s = 1.0 / OnePlus53BitsOf1s;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         <span class="keyword">private</span> Double compute53BitRandom(Double translate, Double scale)
<a name="l00508"></a>00508         {
<a name="l00509"></a>00509             <span class="comment">// get 27 pseudo-random bits</span>
<a name="l00510"></a>00510             UInt64 a = (UInt64)<a class="code" href="class_mersenne_1_1_mersenne_twister.html#ac67afdf144ff89baac5f8754c55ad1c7" title="Generates a new pseudo-random UInt32.">GenerateUInt32</a>() &gt;&gt; 5;
<a name="l00511"></a>00511             <span class="comment">// get 26 pseudo-random bits</span>
<a name="l00512"></a>00512             UInt64 b = (UInt64)<a class="code" href="class_mersenne_1_1_mersenne_twister.html#ac67afdf144ff89baac5f8754c55ad1c7" title="Generates a new pseudo-random UInt32.">GenerateUInt32</a>() &gt;&gt; 6;
<a name="l00513"></a>00513 
<a name="l00514"></a>00514             <span class="comment">// shift the 27 pseudo-random bits (a) over by 26 bits (* 67108864.0) and</span>
<a name="l00515"></a>00515             <span class="comment">// add another pseudo-random 26 bits (+ b).</span>
<a name="l00516"></a>00516             <span class="keywordflow">return</span> ((a * 67108864.0 + b) + translate) * scale;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518             <span class="comment">// What about the following instead of the above? Is the multiply better? </span>
<a name="l00519"></a>00519             <span class="comment">// Why? (Is it the FMUL instruction? Does this count in .Net? Will the JITter notice?)</span>
<a name="l00520"></a>00520             <span class="comment">//return BitConverter.Int64BitsToDouble((a &lt;&lt; 26) + b));</span>
<a name="l00521"></a>00521         }
<a name="l00522"></a>00522     }
<a name="l00523"></a>00523 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Dec 15 22:49:47 2010 for PhysLib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
